---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogLink from "../../components/BlogLink.astro";


export async function getStaticPaths() {
    const allPosts = await Astro.glob("../blog/*.md")
    const uniqueTags = [...new Set(allPosts.map(ap => ap.frontmatter.tags))].flat()
    return uniqueTags.map(t => ({params: {tag: t}, props: {posts: allPosts}}))
}

const { tag } = Astro.params;
const posts = (await Astro.glob("../blog/*.md")).filter(p => p.frontmatter.tags.includes(tag))
---
<BaseLayout pageTitle={tag}>
  <p>Posts tagged with {tag}</p>
  {posts.map(p => <BlogLink post={p}/>)}
</BaseLayout>